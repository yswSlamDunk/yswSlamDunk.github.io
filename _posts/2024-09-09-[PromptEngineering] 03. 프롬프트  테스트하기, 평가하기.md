---
layout : single
title : "[PromptEngineering] 03. 프롬프트 테스트하기, 평가하기"
categories : [PromptEngineering, LLM]
tag : [프롬프트 테스트 규칙, 언어 모델의 한계]
---

## 프롬프트 테스트하기

우선 이 글은 [프롬프트 엔지니어의 업무일지](https://product.kyobobook.co.kr/detail/S000213991301) 내용을 정리해서 작성했습니다. 

> 프롬프트 테스트 단계는 언어 모델에 입력한 프롬프트를 통해 출력 결과를 분석하는 과정



### 프롬프트 테스트와 규칙

#### 프롬프트 테스트가 어려운 이유

1. 프롬프트는 텍스트로 구성된 문장

   * 동일한 프롬프트로 실험할 때마다 결과가 달라질 수 있음
   * 같은 프롬프트의 단어 순서나 요소를 조금 바꿔도 결과가 크게 바뀜
   * 프롬프트로 얻은 답변의 구조와 글의 짜임새를 고려한 정성적인 평가 필요
2. 수학 문제처럼 정답이 하나만 있는 것은 아님

   	* 다양한 답변이 정답이 될 수 있음
	
   	* 목표 부합 여부, 모호한 답변 정도, 핵심 파악 정도, 유용성, 흥미 여부 등의 다양한 기준이 존재
   	* 특정 도메인이나 기능의 목적에 따라 달라짐

3. 언어 모델이 빠르게 발전하고 진화하고 있음
   * 여러 버전의 언어 모델을 사용해도 결과가 일정하고 안정적인 결과 필요



#### 프롬프트 테스트의 내용과 절차

1. 평가 기준 마련
   * 일관된 평가 기준 적용

2. 프롬프트 품질 분석
   * 생성된 결과의 품질 분석

3. 테스트 결과 정리
   * 테스트 결과 정리 및 문서화

4. 최종 프롬프트 선별
   * 테스트 결과를 바탕으로 서비스에 배포할 프롬프트를 선발
   * 선발한 프롬프트를 업무 관계자와 논의하여 다음 작업(문서 정리, 예상 이슈 정리, 관계자 미팅 등) 진행
5. 사용자 피드백 및 이슈 관리
   * 서비스 배포 후 사용자 피드백과 이슈를 기록 및 관리
6. 프롬프트 언어 분석
   * 언어 모델의 반응 패턴 분석 및 약점 파악
   * 개선이나 보완을 위한 프롬프트 연구
7. 지속적인 결과값 개선
   * 모델이 일관되지 않거나 잘못된 결과를 생성할 경우, 프롬프트를 수정하고 언어 모델의 성능을 프롬프트로 업데이트할 수 있도록 연구 및 개발



#### 프롬프트 테스트에 필요한 프롬프트 엔지니어 역량

1. 프롬프트 문해력: 언어 모델의 결과를 해석 및 분석
2. 세부 사항에 대한 주의력: 작고 미묘한 변화를 놓치지 않고 발견
3. 논리적 사고: 프롬프트 테스트를 설계 및 실행
4. 프롬프트 테스트 도구 사용 능력
5. 개발 지식: 기본적인 개발 프로세스에 대한 이해
6. 커뮤니케이션 역량: 개발팀 및 업무 관계자와 효율적인 소통



#### 프롬프트 성능 평가를 위한 열 가지 테스트 규칙

1. 프롬프트는 최소 두 가지 버전으로 준비한다

2. 프롬프트 버전은 기능 이름으로 정한다

   * 기능 이름은 반드시 영어로 작성한다
   * 기능 이름에 버전 번호를 포함시킨다
   * 확장성을 고려해야 한다

3. 각 버전의 목표와 기대 성능을 문서화한다

   * 프롬프트 이름 및 버전
   * 기능 목포* 필자는 프롬프트 대화 데이터를 가지고 있었으며, 해당 데이터를 언어학적 지식을 동반하여 분석함.
   * 기대 성능
   * 사용 사례
   * 제한 사항

4. 프롬프트 테스트에 작위적인 문장을 사용하지 않는다

   * 실제 사용자가 입력할 가능성이 높은 문장이나 질문을 테스트에 사용한다

5. 테스트 데이터셋을 반드시 사용한다

   생성형 AI와의 자연스러운 대화를 반영한 발화 데이터가 적합

   * 대표적이고 빈번하게 사용되는 실제 사용자 발화 데이터
   * 다양한고 포괄적인 내용의 데이터
     * 여러 문체, 내용의 복잡도, 주제를 포함하는 테스트 데이터셋 준비
     * 다양한 사용자 그룹(예: 연령대, 전문성 수준)을 고려한 입력을 포함
   * 예상치 못한 상항이 포함된 데이터
     * 일반적이고 범용적인 사용 사례뿐 아니라 특이한 사레도 테스트에 포함
   * 사용자 오류 패턴이 있는 데이터
     * 오타, 문법 오류, 불완전한 문장을 테스트에 포함
     * 프롬프트의 오류 처리 능력 향상
   * 언어 모델의 한계가 드러난 발화 데이터
     * 의도와 다른 응답 생성
     * 편향된 내용
     * 할루시네이션
     * 일관성 부족
     * 추론 능력 한계
     * 긴 입력처리 문제
     * 희귀하거나 학습되지 않은 주제

6. 테스트 도구를 사용한다

   * 테스트는 동일한 환경에서 한다
   * 프롬프트 엔지니어가 설정한 값을 사용한다
   * 값은 프롬프트와 함께 제공한다
   * A/B 프롬프트 테스트도 동일한 설정 환경에서 시행한다
   * 프롬프트 간에는 일관된 테스트 조건을 유지하며 변수를 통제한다

7. 프롬프트는 최소 열 번 이상 생성한다

   * 반복적으로 생성한 결과의 일관성을 검사한다.

8. 최소 세 명의 작업 관계자가 참여한다

9. 다양한 언어 모델 버전을 사용한다

   * 다양한 모델을 후보로 선정함
   * 서비스할 언어 모델이 확정되었다면, 해당 모델만 사용

10. 프롬프트 테스트 결과를 사용하고 기록한다

    


---



### 프롬프트 테스트 도구와 방법

필자는 프롬프트 테스트 도구로 [프롬프트푸](https://www.promptfoo.dev/docs/intro/)를 추천함



#### 프롬프트푸의 메트릭스

1. 결정적 메트릭스(Deterministic Metrics): 정해진 기준에 따라 일관되게 평가
   * 출력에 특정 콘텐츠가 있는지 여부 확인
   * 출력 포멧 검증
   * 예상값과 출력값이 일치하는지 혹은 유사한지 비교
   * LLM 호출 비용과 지연 시간을 측정
   * 출력 검증을 위한 파이썬 함수 실행
2. 모델 평가 메트릭스(Model-graded Metrics): 모델이 직접 평가하여 점수를 부여
   * 제공된 기준표를 사용하여 LLM으로 출력한 후 평가
   * 참조 답변과 출력의 일관성 여부 확인
   * 원래 질문과 출력의 관련성 평가
   * 제공된 컨텍스트에 대한 출력 평가
   * 여러 출력을 비교하여 지정된 기준에 따라 최상의 출력 선택
3. 유사성 메트릭스(Similarity Metrics): 응답의 유사성을 벡터 형태로 분석
   * 출력이 예상값과 의미적으로 유사한지 확인
   * 유사성 임계값을 설정하여 허용 가능한 유사성 수준 결정
   * 다른 의미의 유사성을 포착하기 위해 다른 임베딩 모델 사용
4. 분류 메트릭스(Classification Metrics): 응답을 분류하여 평가
   * 출력에서 표현된 감정 혹은 정서 감지
   * 유해하거나 공격적인 언어의 존재 여부 식별
   * 출력의 주제나 의도와 같이 사전에 정의된 범주로 분류
   * 출력의 유용성 또는 관련성 평가
   * 생성된 텍스트에서 잠재적 편향 또는 공격성 감지



#### 프롬프트 테스트 방법

* 프롬프트 테스트 방법은 정량적 방법과 정성적 방법 2 가지가 존재
  * 정성적 방법: 사람이 직접 평가
  * 정량적 방법: 테스트 메트릭스를 기준으로 언어 모델을 사용하는 방법
* 정성적 테스트 방법
  * 중앙 집중 경향(Central Tendency Bias)를 고려해, 3점이 없는 1~5점 스케일 사용
  * 평가 항목
    * 정확성: 프롬프트가 해당 과제에 대해 얼마나 정확한 응답을 생성하는지 평가
    * 일관성: 프롬프트를 여러 번 생성하더라도 일관된 응답을 생성하는지 평가
    * 유용성: 프롬프트로 생성된 응답이 실제 유용하고 사용자에게 도움이 되는지 평가
    * 문법 및 문체: 프롬프트로 생성된 응답의 문법과 문체가 적절한지 평가
    * 여러 모델 대응성: 프롬프트가 서비스 중인 여러 모델에서 일관성 있는 응답을 하는지 평가



---



## 프롬프트 평가하기

#### 프롬프트 평가 방법

필자는 프롬프트 대화 데이터를 가지고 있었으며, 해당 데이터를 언어학적 지식을 동반하여 분석함. 분석 내용을 기반으로 메트릭스를 구축하고, LLM을 활용하여 자동으로 정량 평가를 진행함. 해당 방법은 정량적, 정성적 방안의 단점을 개선하고 장점을 극대화 함.

* 필자는 정량적 방법과 정성적 방법을 합한 사용자 중심의 연구를 수행함
* 언어 분석을 기반으로 10개의 평가 메트릭스를 생성
* LLM 평가, 턴을 기준으로 점수 매기기, 예측, 사용자 만족도 순위 평가



#### 사용자 언어 분석 결과

1. 텍스트 레벨
   * 인간이 작성한 것처럼 자연스럽고 유창한 문법, 문체, 어휘의 다양성을 평가
   * 사용자의 질문이나 요청에 질문의 의도를 제대로 파악했는지 또는 정확한 답변을 제공했는지 평가
   * 맥락에 맞는 답변인지 아니면 부적절한 정보나 불필요한 정보를 제공하지 않았는지 살피기 위한 평가
   * 기준
     * 자연스러운 언어
     * 이해/인지력
2. 프리젠테이션 레벨
   * 응답 구조, 내용의 명확성과 완전성을 평가
   * 정보를 명료하고 포괄적으로 전달했는지 평가
   * 기준
     * 명확성
     * 완전성
3. 인터렉션 레벨
   * 사용자 경험의 질을 평가
   * 곤송성, 공감 능력, 유연성, 사용자 참여 유도를 통해 사용자가 편안하고 긍정적인 경험을 할 수 있는지에 중점
   * 기준
     * 공손성
     * 공감 능력
     * 유연성
     * 사용자 참여 유도



